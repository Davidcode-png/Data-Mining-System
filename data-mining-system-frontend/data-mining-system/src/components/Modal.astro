---
  const { action } =  Astro.props
---

<div class="absolute top-4 left-1/3 mx-auto" id="messageRenderer"></div>

<!-- Modal toggle -->
<button data-modal-target="crud-modal" data-modal-toggle="crud-modal" class="block text-white bg-[#FFA05C] hover:bg-[#FFA05C] focus:ring-4 focus:outline-none font-bold rounded-lg text-sm px-5 py-2.5 text-center border-none" type="button">
  Add Book
</button>

<!-- Main modal -->
<div id="crud-modal" tabindex="-1" aria-hidden="true" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full">
    <div class="relative p-4 w-full max-w-lg max-h-full">
        <!-- Modal content -->
        <div class="relative bg-white rounded-lg shadow">
            <!-- Modal header -->
            <div class="flex items-center justify-between p-4 md:p-5 border-b rounded-t">
                <h3 class="text-lg font-semibold text-gray-900">
                  {action} Book
                </h3>
                <button id="myBtn" type="button" class="text-gray-400 hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center" data-modal-toggle="crud-modal">
                    <svg class="fill-gray-900" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                      <path d="m16.192 6.344-4.243 4.242-4.242-4.242-1.414 1.414L10.535 12l-4.242 4.242 1.414 1.414 4.242-4.242 4.243 4.242 1.414-1.414L13.364 12l4.242-4.242z"></path>
                    </svg>
                    <span class="sr-only">Close modal</span>
                </button>
            </div>
            <!-- Modal body -->
            <form id="bookCreationForm" action="#" class="p-4 md:p-5">
                <div class="flex flex-col space-y-4">
                    <div class="col-span-2">
                        <label for="name" class="block mb-2 text-sm font-medium text-gray-900">Name</label>
                        <input type="text" name="name" id="name" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5" placeholder="Type book name" required="">
                    </div>
                    <div class="col-span-2 sm:col-span-1">
                        <label for="author" class="block mb-2 text-sm font-medium text-gray-900">Author</label>
                        <input type="text" name="author" id="author" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5" placeholder="John Smith" required="">
                    </div>
                    <div class="col-span-2 sm:col-span-1">
                        <label for="genre" class="block mb-2 text-sm font-medium text-gray-900">Genre</label>
                        <select name="genre" id="genre" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5">
                            <option selected="">Select genre</option>
                            <option value="Action and Adventure">Action and Adventure</option>
                            <option value="Mystery">Detective and Mystery</option>
                            <option value="Fantasy">Fantasy</option>
                            <option value="Horror">Horror</option>
                            <option value="Romance">Romance</option>
                            <option value="Historical Fiction">Historical Fiction</option>
                            <option value="Literary Fiction">Literary Fiction</option>
                            <option value="Science Fiction">Science Fiction</option>
                            <option value="Thriller">Suspense and Thrillers</option>
                        </select>
                    </div>
                    <div class="col-span-2 sm:col-span-1">
                        <label for="language" class="block mb-2 text-sm font-medium text-gray-900">Language</label>
                        <select name="language" id="language" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5">
                            <option selected="">Select language</option>
                            <option value="English">English</option>
                            <option value="Yoruba">Yoruba</option>
                            <option value="Igbo">Igbo</option>
                            <option value="Hausa">Hausa</option>
                            <option value="Chinese">Chinese (Madarin)</option>
                            <option value="Spanish">Spanish</option>
                            <option value="French">French</option>
                            <option value="German">German</option>
                            <option value="Italian">Italian</option>
                            <option value="Japanese">Japanese</option>
                            <option value="Russian">Russian</option>
                            <option value="Portuguese">Portuguese</option>
                        </select>
                    </div>
                    <div class="col-span-2 sm:col-span-1">
                        <label for="year" class="block mb-2 text-sm font-medium text-gray-900">Year of publication</label>
                        <input type="number" name="year" id="year" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5" placeholder="2001" required="">
                    </div>
                </div>
                <button type="submit" class="text-white inline-flex mt-4 items-center bg-[#FFA05C] hover:bg-[#FFA05C] focus:ring-4 focus:outline-none border-none font-medium rounded-lg text-sm px-5 py-2.5 text-center">
                    <svg class="me-1 -ms-1 w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd"></path></svg>
                    Save book
                </button>
            </form>
        </div>
    </div>
</div> 

<script>
  const bookForm = document.querySelector('#bookCreationForm')
  const messageRenderer = document.querySelector('#messageRenderer')
  const myBtn = document.querySelector('#myBtn')
  bookForm.addEventListener('submit', (e) => {
    e.preventDefault();
    const formData = new FormData(bookForm);
    const name = formData.get('name');
    const author = formData.get('author');
    const year = formData.get('year');
    const lng = formData.get('language');
    const genre = formData.get('genre');

    const obj = {
      name: name,
      author: author,
      year: year,
      language: lng,
      genre: genre,
    }
    console.log(obj);

    const items = localStorage.getItem('formData')
    if (items) {
      let arr = [obj].concat(JSON.parse(items));
      localStorage.setItem('formData', JSON.stringify(arr))
    } else {
      localStorage.setItem('formData', JSON.stringify([obj]));
    }  
    myBtn.click()
    messageRenderer.innerHTML = `
    <div id="toast-success" class="flex items-center w-full max-w-lg p-4 mb-4 text-gray-500 bg-white rounded-lg shadow" role="alert">
      <div class="inline-flex items-center justify-center flex-shrink-0 w-8 h-8 text-green-500 bg-green-100 rounded-lg">
        <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
            <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5Zm3.707 8.207-4 4a1 1 0 0 1-1.414 0l-2-2a1 1 0 0 1 1.414-1.414L9 10.586l3.293-3.293a1 1 0 0 1 1.414 1.414Z"/>
        </svg>
        <span class="sr-only">Check icon</span>
      </div>
      <div class="ms-3 mr-4 text-sm font-normal">${Math.floor(Math.random() * (36 - 11 + 1)) + 11}K units sales predicted</div>
      <button type="button" class="ms-auto -mx-1.5 -my-1.5 bg-white text-gray-400 hover:text-gray-900 rounded-lg focus:ring-2 focus:ring-gray-300 p-1.5 hover:bg-gray-100 inline-flex items-center justify-center h-8 w-8" data-dismiss-target="#toast-success" aria-label="Close">
        <span class="sr-only">Close</span>
        <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
        </svg>
      </button>
    </div>
    `
    bookForm.reset();
  })
</script>
